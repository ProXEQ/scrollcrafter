import{a as m}from"./chunk-2HA4XQFN.js";import{mergeComments as c}from"./index.js";import{splitMultiline as g}from"./utils.js";const o={msgid:/^(msgid(?!_))(.*)/,msgstr:/^(msgstr(?:\[\d+])?)\s+(.*)/,msgctxt:/^(msgctxt)\s+(.*)/,msgid_plural:/^(msgid_plural)\s+(.*)/,extracted:/^(#\.)(.*)/,reference:/^(#:)\s+(.*)/,flag:/^(#(?:[^:.,|]|$))\s+(.*)/,previous:/^(#\|)\s+(.*)/,translator:/^(#(?![.:,|]))\s+(.*)/};class d{static{m(this,"Block")}constructor(t){if(typeof t=="string"&&(t=t.split(`
`)),Array.isArray(t))this.parseBlock(t);else if(typeof t=="object")for(const r in t)typeof this[r]!==null&&(this[r]=t[r])}parseBlock(t){if(!t.length)return;let r,s={};t.forEach(e=>{if(e)if(e.startsWith('"'))r=r||"msgid",s[r]=s[r]||[],s[r].push(e.unquote());else for(const i in o){const n=o[i].exec(e.unquote());if(n){r=i,s[i]||(s[i]=[]),s[i].push(n[2].trim().unquote());break}}}),Object.assign(this,{msgid:s.msgid.join(`"
"`)||"",msgid_plural:s.msgid_plural?.join(`
`),msgstr:s.msgstr||[],msgctxt:s.msgctxt?.join(`
`),comments:{translator:s?.translator,extracted:s?.extracted,reference:s?.reference,flag:s?.flag,previous:s?.previous}})}mapStrings(t=[],r="# "){return t.length?t?.map(s=>r+s).join(`
`):void 0}extractMultiString(t,r="msgstr"){return t.length>1?t.map((s,e)=>`${r}${t.length>1?"["+e+"]":""} "${g(s)}"`).join(`
`):t.length===1?`${r} "${t[0]}"`:`${r} ""`}toStr(){const{comments:t,msgid:r,msgid_plural:s,msgstr:e,msgctxt:i}=this;return[this.mapStrings(t?.translator),this.mapStrings(t?.extracted,"#. "),this.mapStrings(t?.reference,"#: "),t?.flag?`#, ${t.flag}`:void 0,this.mapStrings(t?.previous,"#| "),i?`msgctxt "${i}"`:void 0,r?`msgid "${g(r)}"`:'msgid ""',s?`msgid_plural "${s}"`:void 0,e?this.extractMultiString(e):'msgstr ""'].filter(Boolean).filter(l=>l?.length).join(`
`)}toJson(){const{comments:t,msgid:r="",msgid_plural:s,msgstr:e=[],msgctxt:i=""}=this;return{msgctxt:i,msgid:r,msgid_plural:s,msgstr:e,comments:{translator:t?.translator?.join(`
`)||"",extracted:t?.extracted?.join(`
`)||"",reference:t?.reference?.join(`
`)||"",flag:t?.flag||"",previous:t?.previous?.join(`
`)||""}}}hash(){const t=(this.msgctxt||"")+"|"+(this.msgid||"");let r=2166136261;for(let s=0;s<t.length;s++)r^=t.charCodeAt(s),r*=16777619;return r>>>0}merge(t){this.msgid===t.msgid&&(this.msgid_plural=this.msgid_plural||t.msgid_plural,this.msgctxt=this.msgctxt||t.msgctxt,this.msgstr=this.msgstr||t.msgstr,this.comments=c(this.comments,t.comments))}}export{d as Block,o as matcher};
