"use strict";var C=Object.create;var m=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var O=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var K=(e,t)=>{for(var s in t)m(e,s,{get:t[s],enumerable:!0})},$=(e,t,s,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of L(t))!z.call(e,o)&&o!==s&&m(e,o,{get:()=>t[o],enumerable:!(c=F(t,o))||c.enumerable});return e};var M=(e,t,s)=>(s=e!=null?C(O(e)):{},$(t||!e||!e.__esModule?m(s,"default",{value:e,enumerable:!0}):s,e)),j=e=>$(m({},"__esModule",{value:!0}),e);var I={};K(I,{doTree:()=>E});module.exports=j(I);var k=M(require("tree-sitter")),y=require("../const.js"),d=require("gettext-merger"),v=require("../fs/glob.js"),f=require("../utils/common.js");function D(e){let t=e,s=0;for(;t&&s<6;){if(t?.previousSibling?.type==="comment"&&t?.previousSibling?.text.toLowerCase().includes("translators"))return t?.previousSibling?.text?(0,f.stripTranslationMarkup)(t.previousSibling.text):void 0;s++,t=t.parent}}function E(e,t,s,c){const o=new k.default,x=(0,v.getParser)(t);if(!x)return new d.SetOfBlocks([],t);o.setLanguage(x);const _=new d.SetOfBlocks([],t),N=t.split(".").pop()?.toLowerCase()!=="php"?"call_expression":"function_call_expression",B=["name","string","string_value","variable_name","binary_expression","member_expression","subscript_expression","shell_command_expression","function_call_expression","encapsed_string"];function b(n){if(n?.children.length)for(const r of n.children)b(r);if(n?.type===N){const r=n.firstChild?.text??null;if(r===null||!Object.keys(y.i18nFunctions).includes(r))return;const l=n.lastChild;if(l===null||l.childCount===0||l.type!=="arguments")return;const[U,P]=n.children,a={text_domain:"default"},h=y.i18nFunctions[r],T=P.children.slice(1,-1);let g=0;for(const p of T){let i=p,u=i.text;if(p.type==="argument"){if(p.children.length===0)continue;i=p.children[0]}if(i?.type===",")continue;const w=h[g];if(i?.type&&B.includes(i.type))u=u.slice(1,-1);else if(w==="number")u=i.text;else{console.error(`Unexpected node type ${i?.type} identified as ${h[g]} with value ${u} in ${t} at ${i.startPosition.row+1} pos ${i.startPosition.column+1}`);return}a[w]=u,g+=1}if(Array.isArray(c?.options?.translationDomains)&&!c.options.translationDomains.includes(a.text_domain))return;const S=D(l),A=new d.Block({msgctxt:a.msgctxt,msgid:a.msgid??"",msgid_plural:a.msgid_plural,msgstr:a.msgid_plural?["",""]:[""],comments:{translator:S?[S]:void 0,reference:[`${(0,f.reverseSlashes)(t)}:${n.startPosition.row+1}`]}});_.add(A)}}try{if(e){const n=Buffer.byteLength(e,"utf8");let r=1024*32;n>=r&&(r=n+32),n>=1024*1024*2&&console.warn(`File size warning: ${t} exceeds 2 MB.`);const l=o.parse(e,void 0,{bufferSize:r});l&&b(l.rootNode)}}catch(n){console.error(`Failed to parse ${t}: ${n}`)}return _}0&&(module.exports={doTree});
