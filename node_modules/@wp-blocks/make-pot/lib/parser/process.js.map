{
  "version": 3,
  "sources": ["../../src/parser/process.ts"],
  "sourcesContent": ["import path from \"node:path\";\r\nimport type { SingleBar } from \"cli-progress\";\r\nimport type { SetOfBlocks } from \"gettext-merger\";\r\nimport { allowedFormats } from \"../const.js\";\r\nimport { parseJsonCallback } from \"../extractors/json.js\";\r\nimport { readFileAsync } from \"../fs/fs.js\";\r\nimport { getFiles } from \"../fs/glob.js\";\r\nimport type { Args, Patterns } from \"../types.js\";\r\nimport { doTree } from \"./tree.js\";\r\n\r\n/**\r\n * Processes the given files and returns an array of promises that resolve to TranslationStrings.\r\n *\r\n * @param patterns\r\n * @param {Args} args - The arguments for processing the files.\r\n * @param progressBar - The progress bar element.\r\n * @return {Promise<SetOfBlocks[]>} - An array of promises that resolve to TranslationStrings.\r\n */\r\nexport async function processFiles(\r\n\tpatterns: Patterns,\r\n\targs: Args,\r\n\tprogressBar?: SingleBar,\r\n): Promise<Promise<SetOfBlocks>[]> {\r\n\tconst tasks: Promise<SetOfBlocks>[] = [];\r\n\tlet processedFilesCount = 0;\r\n\r\n\tconst files = getFiles(args, patterns);\r\n\r\n\tif (progressBar) {\r\n\t\tprogressBar.setTotal(Object.values(files).length);\r\n\t\tprogressBar.update(0, {\r\n\t\t\tfilename: `Found ${Object.values(files).length} files`,\r\n\t\t});\r\n\t}\r\n\r\n\t// loop through the files and parse them\r\n\tfor await (const file of files) {\r\n\t\tprocessedFilesCount++;\r\n\t\tconst filename = path.basename(file);\r\n\t\tconst ext = path.extname(file).replace(/^./, \"\");\r\n\t\tconst fileRealPath = path.resolve(args.paths.cwd, file);\r\n\r\n\t\tif (filename === \"theme.json\" || filename === \"block.json\") {\r\n\t\t\ttasks.push(\r\n\t\t\t\treadFileAsync(fileRealPath).then((sourceCode) =>\r\n\t\t\t\t\tparseJsonCallback(sourceCode, args.paths.cwd, filename),\r\n\t\t\t\t),\r\n\t\t\t);\r\n\t\t} else if (allowedFormats.includes(ext)) {\r\n\t\t\tconst fileTree = readFileAsync(fileRealPath).then((content) =>\r\n\t\t\t\tdoTree(content, file, args.debug, args),\r\n\t\t\t);\r\n\t\t\tif (fileTree) {\r\n\t\t\t\ttasks.push(fileTree as Promise<SetOfBlocks>);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (progressBar) {\r\n\t\t\tprogressBar.update(processedFilesCount, { filename: filename });\r\n\t\t\tprogressBar.render();\r\n\t\t}\r\n\t}\r\n\r\n\treturn tasks;\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAAiB;AAGjB,mBAA+B;AAC/B,kBAAkC;AAClC,gBAA8B;AAC9B,kBAAyB;AAEzB,kBAAuB;AAUvB,eAAsB,aACrB,UACA,MACA,aACkC;AAClC,QAAM,QAAgC,CAAC;AACvC,MAAI,sBAAsB;AAE1B,QAAM,YAAQ,sBAAS,MAAM,QAAQ;AAErC,MAAI,aAAa;AAChB,gBAAY,SAAS,OAAO,OAAO,KAAK,EAAE,MAAM;AAChD,gBAAY,OAAO,GAAG;AAAA,MACrB,UAAU,SAAS,OAAO,OAAO,KAAK,EAAE,MAAM;AAAA,IAC/C,CAAC;AAAA,EACF;AAGA,mBAAiB,QAAQ,OAAO;AAC/B;AACA,UAAM,WAAW,iBAAAA,QAAK,SAAS,IAAI;AACnC,UAAM,MAAM,iBAAAA,QAAK,QAAQ,IAAI,EAAE,QAAQ,MAAM,EAAE;AAC/C,UAAM,eAAe,iBAAAA,QAAK,QAAQ,KAAK,MAAM,KAAK,IAAI;AAEtD,QAAI,aAAa,gBAAgB,aAAa,cAAc;AAC3D,YAAM;AAAA,YACL,yBAAc,YAAY,EAAE;AAAA,UAAK,CAAC,mBACjC,+BAAkB,YAAY,KAAK,MAAM,KAAK,QAAQ;AAAA,QACvD;AAAA,MACD;AAAA,IACD,WAAW,4BAAe,SAAS,GAAG,GAAG;AACxC,YAAM,eAAW,yBAAc,YAAY,EAAE;AAAA,QAAK,CAAC,gBAClD,oBAAO,SAAS,MAAM,KAAK,OAAO,IAAI;AAAA,MACvC;AACA,UAAI,UAAU;AACb,cAAM,KAAK,QAAgC;AAAA,MAC5C;AAAA,IACD;AAEA,QAAI,aAAa;AAChB,kBAAY,OAAO,qBAAqB,EAAE,SAAmB,CAAC;AAC9D,kBAAY,OAAO;AAAA,IACpB;AAAA,EACD;AAEA,SAAO;AACR;",
  "names": ["path"]
}
