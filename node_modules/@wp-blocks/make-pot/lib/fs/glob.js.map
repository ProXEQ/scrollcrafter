{
  "version": 3,
  "sources": ["../../src/fs/glob.ts"],
  "sourcesContent": ["import path from \"node:path\";\r\nimport { Glob, type Path } from \"glob\";\r\nimport { minimatch } from \"minimatch\";\r\n// @ts-expect-error\r\nimport * as javascript from \"tree-sitter-javascript\";\r\n// @ts-expect-error\r\nimport * as php from \"tree-sitter-php\";\r\n// @ts-expect-error\r\nimport * as ts from \"tree-sitter-typescript\";\r\nimport type { Args, Patterns } from \"../types.js\";\r\nimport { detectPatternType, getFileExtension } from \"../utils/common.js\";\r\n\r\n/**\r\n * Return the parser based on the file extension\r\n *\r\n * @param file - Path to the file\r\n * @return {Parser|null} - the parser to be used with the file or null if no parser is found\r\n */\r\nexport function getParser(\r\n\tfile: string,\r\n): string | { name: string; language: unknown } | null {\r\n\tconst ext = getFileExtension(file);\r\n\tswitch (ext) {\r\n\t\tcase \"ts\":\r\n\t\t\treturn ts.typescript;\r\n\t\tcase \"tsx\":\r\n\t\t\treturn ts.tsx;\r\n\t\tcase \"js\":\r\n\t\tcase \"jsx\":\r\n\t\tcase \"mjs\":\r\n\t\tcase \"cjs\":\r\n\t\t\treturn javascript;\r\n\t\tcase \"php\":\r\n\t\t\treturn php.php;\r\n\t\tcase \"blade.php\":\r\n\t\t\treturn php.php_only;\r\n\t\tdefault:\r\n\t\t\treturn null;\r\n\t}\r\n}\r\n\r\n// Build the ignore function for Glob\r\nexport const ignoreFunc = (\r\n\tfilePath: Path,\r\n\texcludedPatterns: string[],\r\n): boolean => {\r\n\treturn excludedPatterns.some((exclude) => {\r\n\t\tconst type = detectPatternType(exclude);\r\n\t\t// return true to ignore\r\n\t\tswitch (type) {\r\n\t\t\tcase \"file\":\r\n\t\t\t\treturn filePath.isNamed(exclude);\r\n\t\t\tcase \"directory\":\r\n\t\t\t\treturn filePath.relative().includes(exclude);\r\n\t\t\tdefault:\r\n\t\t\t\t// Handle glob patterns using minimatch\r\n\t\t\t\treturn minimatch(filePath.relative(), exclude);\r\n\t\t}\r\n\t}) as boolean;\r\n};\r\n\r\n/**\r\n * Retrieves a list of files based on the provided arguments and patterns.\r\n *\r\n * @param {Args} args - The argument object containing the source directory and other options.\r\n * @param {Patterns} pattern - The pattern object containing the included and excluded file patterns.\r\n * @return A promise that resolves to an array of file paths.\r\n */\r\nexport function getFiles(args: Args, pattern: Patterns) {\r\n\t// Execute the glob search with the built patterns\r\n\treturn new Glob(pattern.include, {\r\n\t\tignore: {\r\n\t\t\tignored: (p: Path) => ignoreFunc(p, pattern.exclude),\r\n\t\t},\r\n\t\tnodir: true,\r\n\t\tcwd: args.paths.cwd,\r\n\t\troot: args.paths.root ? path.resolve(args.paths.root) : undefined,\r\n\t});\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAAiB;AACjB,kBAAgC;AAChC,uBAA0B;AAE1B,iBAA4B;AAE5B,UAAqB;AAErB,SAAoB;AAEpB,oBAAoD;AAQ7C,SAAS,UACf,MACsD;AACtD,QAAM,UAAM,gCAAiB,IAAI;AACjC,UAAQ,KAAK;AAAA,IACZ,KAAK;AACJ,aAAO,GAAG;AAAA,IACX,KAAK;AACJ,aAAO,GAAG;AAAA,IACX,KAAK;AAAA,IACL,KAAK;AAAA,IACL,KAAK;AAAA,IACL,KAAK;AACJ,aAAO;AAAA,IACR,KAAK;AACJ,aAAO,IAAI;AAAA,IACZ,KAAK;AACJ,aAAO,IAAI;AAAA,IACZ;AACC,aAAO;AAAA,EACT;AACD;AAGO,MAAM,aAAa,CACzB,UACA,qBACa;AACb,SAAO,iBAAiB,KAAK,CAAC,YAAY;AACzC,UAAM,WAAO,iCAAkB,OAAO;AAEtC,YAAQ,MAAM;AAAA,MACb,KAAK;AACJ,eAAO,SAAS,QAAQ,OAAO;AAAA,MAChC,KAAK;AACJ,eAAO,SAAS,SAAS,EAAE,SAAS,OAAO;AAAA,MAC5C;AAEC,mBAAO,4BAAU,SAAS,SAAS,GAAG,OAAO;AAAA,IAC/C;AAAA,EACD,CAAC;AACF;AASO,SAAS,SAAS,MAAY,SAAmB;AAEvD,SAAO,IAAI,iBAAK,QAAQ,SAAS;AAAA,IAChC,QAAQ;AAAA,MACP,SAAS,CAAC,MAAY,WAAW,GAAG,QAAQ,OAAO;AAAA,IACpD;AAAA,IACA,OAAO;AAAA,IACP,KAAK,KAAK,MAAM;AAAA,IAChB,MAAM,KAAK,MAAM,OAAO,iBAAAA,QAAK,QAAQ,KAAK,MAAM,IAAI,IAAI;AAAA,EACzD,CAAC;AACF;",
  "names": ["path"]
}
